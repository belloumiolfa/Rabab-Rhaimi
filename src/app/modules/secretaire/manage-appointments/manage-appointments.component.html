<h2>Gestion des Rendez-vous</h2>

<label for="statusFilter">Filtrer par statut :</label>
<select [(ngModel)]="selectedStatus" (change)="onStatusChange()">
  <option value="">Tous</option>
  <option value="en_attente">En attente</option>
  <option value="accepte">Accepté</option>
  <option value="refuse">Refusé</option>
  <option value="annule">Annulé</option>
</select>

<!-- Tableau des rendez-vous -->
<table class="appointments-table">
  <thead>
    <tr>
      <th>Patient</th>
      <th>Date</th>
      <th>Statut</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let rdv of filteredAppointments">
      <td>{{ rdv.patient_id }}</td>
      <td>{{ formatLocalDate(rdv.date_time) }}</td>
      <td>
        <span class="status" [ngClass]="rdv.status">{{ rdv.status }}</span>
      </td>
      <td>
        <button *ngIf="rdv.status === 'en_attente'" (click)="accepter(rdv.id)" class="btn orange">Accepter</button>
        <button *ngIf="rdv.status === 'en_attente'" (click)="refuser(rdv)" class="btn red">Refuser</button>
        <button (click)="cancelWithProposal(rdv)" class="btn yellow">Annuler</button>
        <button *ngIf="rdv.status === 'en_attente' || rdv.status === 'accepte'" 
                (click)="ouvrirFormulaire(rdv)" class="btn black">Modifier</button>
      </td>
    </tr>
  </tbody>
</table>

<!-- Composants -->
<app-modifier-rdv
  *ngIf="rdvAModifier" 
  [rdv]="rdvAModifier"
  (fermer)="fermerFormulaire()"
  (majListe)="loadAppointments()">
</app-modifier-rdv>

<button (click)="ouvrirFormulaireAjout()" class="btn orange">Nouveau rendez-vous</button>

<app-ajouter-rdv
  *ngIf="ajouterRdvOuvert"
  (fermer)="fermerFormulaireAjout()"
  (majListe)="loadAppointments()">
</app-ajouter-rdv>

<!-- Formulaire proposition -->
<div *ngIf="rdvARefuser" class="proposition-form">
  <h4>Proposer une autre date</h4>
  <p>Patient : {{ rdvARefuser.patient_id }}</p>

  <label>Nouvelle date :</label>
  <input type="datetime-local" [(ngModel)]="propositionDate" />

  <label>Commentaire :</label>
  <textarea [(ngModel)]="commentaire"></textarea>

  <button (click)="envoyerProposition()" class="btn black">Envoyer</button>
  <button (click)="rdvARefuser = null" class="btn red">Annuler</button>
</div>
